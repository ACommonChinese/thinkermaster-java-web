# 多表操作


表之间的关系有:
- 一对多: 一个用户对应多个订单
- 多对一: 多个订单对应一个用户
- 一对一: 一个人对应一个身份证号
- 多对多: 一个学生被多个老师教, 一个老师教多个学生  

特别说明:  
    如果拿出每一个订单, 它都只属于一个用户, 这种情况MyBatis把多对一看成了一对一

-------------------------------------------------------------------

### 用户和帐户示例
一个用户可以有多个帐户, 一个帐户只能属于一个用户(多个帐户也可以属于同一个用户)

步骤：
1、建立两张表：用户表，账户表
     让用户表和账户表之间具备一对多的关系：需要使用外键在账户表中添加
2、建立两个实体类：用户实体类和账户实体类
    让用户和账户的实体类能体现出来一对多的关系
3、建立两个配置文件
  	用户的配置文件
		账户的配置文件
4、实现配置：
		当我们查询用户时，可以同时得到用户下所包含的账户信息
		当我们查询账户时，可以同时得到账户的所属用户信息

用户和帐户, 一对多示例, 首先数据准备, 参见`./demos/mybatisdb.sql`

```
DROP TABLE IF EXISTS `user`;

CREATE TABLE `user` (
  `id` int(11) NOT NULL auto_increment,
  `username` varchar(32) NOT NULL COMMENT '用户名称',
  `birthday` datetime default NULL COMMENT '生日',
  `sex` char(1) default NULL COMMENT '性别',
  `address` varchar(256) default NULL COMMENT '地址',
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert  into `user`(`id`,`username`,`birthday`,`sex`,`address`) values (41,'老王','2018-02-27 17:47:08','男','北京'),(42,'小二王','2018-03-02 15:09:37','女','北京金燕龙'),(43,'小二王','2018-03-04 11:34:34','女','北京金燕龙'),(45,'大刘','2018-03-04 12:04:06','男','北京金燕龙'),(46,'老王','2018-03-07 17:37:26','男','北京'),(48,'小马宝莉','2018-03-08 11:44:00','女','北京修正');

DROP TABLE IF EXISTS `account`;

CREATE TABLE `account` (
  `ID` int(11) NOT NULL COMMENT '编号',
  `UID` int(11) default NULL COMMENT '用户编号',
  `MONEY` double default NULL COMMENT '金额',
  PRIMARY KEY  (`ID`),
  KEY `FK_Reference_8` (`UID`),
  CONSTRAINT `FK_Reference_8` FOREIGN KEY (`UID`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert  into `account`(`ID`,`UID`,`MONEY`) values (1,46,1000),(2,45,1000),(3,46,2000);
```

```
mysql> select * from account;
+----+------+-------+
| ID | UID  | MONEY |
+----+------+-------+
|  1 |   46 |  1000 |
|  2 |   45 |  1000 |
|  3 |   46 |  2000 |
+----+------+-------+
3 rows in set (0.00 sec)

mysql> select * from user;
+----+--------------+---------------------+------+-----------------+
| id | username     | birthday            | sex  | address         |
+----+--------------+---------------------+------+-----------------+
| 41 | 老王         | 2018-02-27 17:47:08 | 男   | 北京            |
| 42 | 小二王       | 2018-03-02 15:09:37 | 女   | 北京金燕龙      |
| 43 | 小二王       | 2018-03-04 11:34:34 | 女   | 北京金燕龙      |
| 45 | 大刘         | 2018-03-04 12:04:06 | 男   | 北京金燕龙      |
| 46 | 老王         | 2018-03-07 17:37:26 | 男   | 北京            |
| 48 | 小马宝莉     | 2018-03-08 11:44:00 | 女   | 北京修正        |
+----+--------------+---------------------+------+-----------------+
```

account表的UID是外键自user表, 而account的id是其主键, user对account为一对多  

sql语句查找account的同时查找对应的user:

```
select * from account a, user u where a.UID = u.id 
# 也可以把UID写成uid:  select * from account a, user u where a.uid = u.id;
# 不区分大小写
+----+------+-------+----+----------+---------------------+------+-----------------+
| ID | UID  | MONEY | id | username | birthday            | sex  | address         |
+----+------+-------+----+----------+---------------------+------+-----------------+
|  1 |   46 |  1000 | 46 | 老王     | 2018-03-07 17:37:26 | 男   | 北京            |
|  2 |   45 |  1000 | 45 | 大刘     | 2018-03-04 12:04:06 | 男   | 北京金燕龙      |
|  3 |   46 |  2000 | 46 | 老王     | 2018-03-07 17:37:26 | 男   | 北京            |
+----+------+-------+----+----------+---------------------+------+-----------------+
```

为了便名字看起来易区分, 也可取别名:

```
mysql> select u.*, a.id as aid, a.uid, a.money from account a, user u where u.id = a.uid;
+----+----------+---------------------+------+-----------------+-----+------+-------+
| id | username | birthday            | sex  | address         | aid | uid  | money |
+----+----------+---------------------+------+-----------------+-----+------+-------+
| 46 | 老王     | 2018-03-07 17:37:26 | 男   | 北京            |   1 |   46 |  1000 |
| 45 | 大刘     | 2018-03-04 12:04:06 | 男   | 北京金燕龙      |   2 |   45 |  1000 |
| 46 | 老王     | 2018-03-07 17:37:26 | 男   | 北京            |   3 |   46 |  2000 |
+----+----------+---------------------+------+-----------------+-----+------+-------+
```

假设我们只取id, username, address, uid

```
select a.*, u.username, u.address from account a, user u where u.id = a.uid;

+----+------+-------+----------+-----------------+
| ID | UID  | MONEY | username | address         |
+----+------+-------+----------+-----------------+
|  1 |   46 |  1000 | 老王     | 北京            |
|  2 |   45 |  1000 | 大刘     | 北京金燕龙      |
|  3 |   46 |  2000 | 老王     | 北京            |
+----+------+-------+----------+-----------------+
```
